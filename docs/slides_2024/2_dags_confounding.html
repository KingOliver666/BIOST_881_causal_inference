<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>L2: DAGs and Confounding</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jean Morrison" />
    <script src="libs/header-attrs-2.22/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <script src="libs/mark.js-8.11.1/mark.min.js"></script>
    <link href="libs/xaringanExtra-search-0.0.1/search.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-search-0.0.1/search.js"></script>
    <script>window.addEventListener('load', function() { window.xeSearch = new RemarkSearch({"position":"bottom-left","caseSensitive":false,"showIcon":true,"autoSearch":true}) })</script>
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.10/grViz.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# L2: DAGs and Confounding
]
.author[
### Jean Morrison
]
.institute[
### University of Michigan
]
.date[
### Lecture on 2024-01-17 (updated: 2024-01-22)
]

---

`\(\newcommand{\ci}{\perp\!\!\!\perp}\)`
`\(\newcommand{\nci}{\not\!\perp\!\!\!\perp}\)`




## Lecture Outline 

1. Representing Causal Relationships in Directed, Acyclic Graphs (DAGs)

1. Connecting DAGs to Counterfactuals

1. Using the backdoor criterion to identify conditional exchangeability.

1. Single World Intervention Graphs


---
# 1. Representing Causal Relationships in Directed, Acyclic Graphs (DAGs)

---

## Graphical Representations of Casual Effects

+ We can represent causal effects in a graph, with arrows. 

+ Nodes in the graph are random variables. 

+ Directed edges represent direct causal effects (not mediated by any other variables in the graph).

+ The absence of an edge indicates the absence of a direct causal effect. 
--

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-09eb45ed91399452166b" style="width:90%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-09eb45ed91399452166b">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"1,0!\"] \n  \"3\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"2.2,0!\"] \n  \"4\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"3.2,0!\"] \n  \"5\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"2.7,0.5!\"] \n\"1\"->\"2\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"5\"->\"4\" [color = \"black\"] \n\"5\"->\"3\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

---

## Why Use Graphs

- Graphs are a natural way of encoding scientific understanding of the world. 

- For many people, the graph encoding is fairly intuitive. 
  - This makes them a useful tool for communicating structural assumptions across domains. 

- Under some assumptions, graphical properties can be used to easily solve problems that are hard to solve otherwise. 
  - In particular, graphs are very useful for answering the question "what variables should I condition on?".
  
  


---


## Graph Definitions 

- A graph, `\(\mathcal{G} = \lbrace V, E\rbrace\)` consists of
  - A set of nodes (vertices) `\(V = \lbrace V_1, \dots, V_J\rbrace\)`
  - A set of edges `\(E = \lbrace (V_{1_1}, V_{1_2}), \dots, (V_{K_1}, V_{K_2}) \rbrace\)`, which can be represented as pairs of nodes.
  
- A graph can be either *directed*, in which case elements of `\(E\)` are ordered pairs or *undirected*, in which case
elements of `\(E\)` are un-ordered. 
  - Our graphs will almost always be directed. 

- Two nodes are *adjacent* if they are connected by an edge. 
  + If the edge is directed, the node at the beginning of the edge is the *parent* and the node at the end is the *child*.

---

## Graph Definitions

- A *path* is a sequence of edges in which each edge contains one node from the previous edge.

- In a directed path, all of the edges are oriented in the same direction: i.e. each edge starts at last node of the previous edge. 

- In this graph:

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-99e1b564881bcac26602" style="width:40%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-99e1b564881bcac26602">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.5!\"] \n\"1\"->\"2\" [color = \"black\"] \n\"3\"->\"2\" [color = \"black\"] \n\"3\"->\"1\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;

there are two paths from `\(A\)` to `\(Y\)` but only one directed path. 

---

## Graph Definitions

- If there are no paths between two nodes, they are *disconnected* (or *connected* otherwise).

- Node `\(j\)` is a descendant of node `\(k\)` if there is a directed path from `\(V_j\)` to `\(V_k\)`. 

- If a graph contains no directed cycles, it is *acyclic*
  + We will require all of our graphs to be acyclic.

- DAG = Directed Acyclic Graph
---

## Example: 

+ Consider this story:

  - There are two possible treatments for a disease. Treatment `\(A = 1\)` is more effective than `\(A = 0\)`, but has more side effects.
  - Doctors prefer treatment `\(A = 0\)` for patients who are older or who have more mild disease.
  - Patient outcome (remission or not) is affected by initial severity, treatment, and treatment adherence.
  - Conditional on everything else, age has no effect on patient outcome or disease severity.

--

+ Work with your neighbor to arrange the following variables in a DAG (there is more than one right answer):

  - Patient outcome
  - Initial disease severity
  - Treatment
  - Treatment Adherence
  - Age


---
## Disease Treatment Example 

&lt;center&gt;
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-faba840eb7da1eb33b7a" style="width:90%;height:504px;"></div>
<script type="application/json" data-for="htmlwidget-faba840eb7da1eb33b7a">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Age\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,1.2!\"] \n  \"2\" [label = \"Severity\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,-1.2!\"] \n  \"3\" [label = \"Treatment\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"2,0!\"] \n  \"4\" [label = \"Outcome\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"4,0!\"] \n  \"5\" [label = \"Adherence\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"3,1.2!\"] \n\"1\"->\"3\" [color = \"black\"] \n\"2\"->\"3\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"5\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

---
## Temporality

- Our definition of causality requires that the exposure occur before the outcome in time. 

- Under this restriction, a causal DAG must be consistent with at least one strict ordering of nodes.
  
--

- How do we represent a feedback loop?

--
  + We can create multiple nodes representing unique time points (e.g. `\(A_1, A_2, \dots\)`), with each node only permitted to have causal effects on future nodes.
  + More on this later. 


&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d05a692ead888484d4a1" style="width:90%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-d05a692ead888484d4a1">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"1,0!\"] \n  \"3\" [label = <A<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"2,0.3!\"] \n  \"4\" [label = <Y<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"2.5,-0.3!\"] \n  \"5\" [label = <A<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"3,0.3!\"] \n  \"6\" [label = <Y<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"3.5,-0.3!\"] \n\"1\"->\"2\" [color = \"black\"] \n\"2\"->\"1\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"4\"->\"5\" [color = \"black\"] \n\"4\"->\"6\" [color = \"black\"] \n\"5\"->\"6\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;
&lt;!-- - What if measurements are taken at the same time? --&gt;

&lt;!-- -- --&gt;
&lt;!--   + We are generally forced to assume a temporal ordering even if our observations are taken at the same time.  --&gt;
&lt;!--   + For example, if we measure height and blood pressure, we can assume that height is stable over a long period of time while blood pressure is more variable. --&gt;

---
## Causal Markov Property

- The causal Markov property translates graph structure into probability statements.

+ It states that, conditional on it's parents, each node is independent of all nodes that are not not it's descendants. 

+ This implies that the joint probability distribution of all nodes can be factored as

$$
P(V) = \prod_{j = 1}^{J} P(V_j \vert pa_j).
$$


---

## Example

Conditional independence statements in the disease tratment graph:

`$$S\ci A \qquad S\ci Ad \qquad A \ci Ad$$`
`$$T \ci Ad\ \vert A, S \qquad O \ci A \ \vert S, T, Ad$$`
&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-fd4fdc4c204407666be5" style="width:432px;height:360px;"></div>
<script type="application/json" data-for="htmlwidget-fd4fdc4c204407666be5">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Age\nA\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,1.2!\"] \n  \"2\" [label = \"Severity\nS\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,-1.2!\"] \n  \"3\" [label = \"Treatment\nT\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"2,0!\"] \n  \"4\" [label = \"Outcome\nO\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"4,0!\"] \n  \"5\" [label = \"Adherence\nAd\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"3,1.2!\"] \n\"1\"->\"3\" [color = \"black\"] \n\"2\"->\"3\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"5\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

---

## Example

In our example, we can factor the joint probability as 

`$$P(A, S, T, Ad, O) = P(A)P(S)P(Ad)P(T \vert A, S)P(O \vert S, T, Ad)$$`

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-16908929a2e304e09604" style="width:432px;height:360px;"></div>
<script type="application/json" data-for="htmlwidget-16908929a2e304e09604">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Age\nA\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,1.2!\"] \n  \"2\" [label = \"Severity\nS\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,-1.2!\"] \n  \"3\" [label = \"Treatment\nT\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"2,0!\"] \n  \"4\" [label = \"Outcome\nO\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"4,0!\"] \n  \"5\" [label = \"Adherence\nAd\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"3,1.2!\"] \n\"1\"->\"3\" [color = \"black\"] \n\"2\"->\"3\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"5\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;


---

# 2. Connecting DAGs and Counterfactuals through the 'do' Operator

---
## The 'do' Operator

- In order for a graph to be a **causal graph**, it must say something about counterfactual worlds in which a variable is **set** to a particular value. 

- Judea Pearl makes this connection by introducing the 'do' operator and 'graph surgery'. We will see two other ways to make this connection in this lecture. 

- The operation `\(do(X = x)\)` indicates the intervention of setting the variable `\(X\)` equal to `\(x\)`. 

---
## 'do' Operator in DAGs

- Pearl suggests that the action of setting `\(X\)` to `\(x\)` can be represented graphically by removing all of the arrows into `\(X\)`. 

- This is because, in the interventional world, `\(X\)` is no longer affected by its parents, we determined what it would be

---
## Pearl's Graph Surgery

.pull-left[
Original DAG

&lt;img src="img/2_sprinkler_dag_1.png" width="90%" /&gt;
$$
`\begin{split}
P(\mathbf{x}) = P(x_1) P(x_2 \vert x_1)P(x_3, \vert x_1)\\P(x_4 \vert x_2, x_3)P(x_5 \vert x_4)
\end{split}`
$$
]
.pull-right[
DAG with intervention "turning sprinkler on".

&lt;img src="img/2_sprinkler_dag_2.png" width="90%" /&gt;

$$
`\begin{split}
P_{X_3 = ON}(\mathbf{x}) = &amp; P(x_1) P(x_2 \vert x_1)\\&amp; P(x_4 \vert x_2, X_3 = ON)\\ &amp; P(x_5 \vert x_4)
\end{split}`
$$
]
---
 
# 3. Connecting DAGs and Counterfactuals through Structural Equation Models

---

## Structural Equation Models

- In a **structural equation** the bit on the left is qualitatively different from the bit on the right. 

- The bit on the left is a counterfactual. 

---

## Example

- Suppose we have a machine for measuring blood pressure. 

- `\(X\)` represents the true systolic blood pressure and `\(Y\)` represents the measured systolic blood pressure. 

- Suppose that the machine has some small amount of error. 

- We can represent this system with a graph:

&lt;center&gt;
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-585698db0f6b3813cca8" style="width:50%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-585698db0f6b3813cca8">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"X\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", fillcolor = \"#FFFFFF\", pos = \"1,0!\"] \n\"1\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;
---

## Example

- We could also represent the system with an equation 

`$$Y = X + \epsilon_Y$$`
where `\(\epsilon_Y\)` is a random variable that is the error of the machine. 

- Mathematically, it would be equivalent to say 

`$$X = Y - \epsilon_Y$$`

- But the first equation is structural while the second is not. 

- We can find the counterfactual value `\(Y(X = x)\)` by plugging `\(x\)` into the first equation. 

- The second equation is descriptive but not counterfactual. 

---

## Non-Parametric Structural Equation Models

- We can link a graph to a causal model with a system of non-parametric structural equations. 

- Let `\(\mathcal{G} = \lbrace V, E \rbrace\)` is a directed graph with nodes `\(V_1, \dots, V_n\)`.

- Let `\(\epsilon_1, \dots, \epsilon_n\)` be a set of random variables corresponding to each node. 

- We assume that for a given `\(V_i\)` with parents `\(\mathbf{pa}_i \subset V\)`, there is a counterfactual `\(V_i(\mathbf{pa}_i)\)` given by the 
structural equation 
`$$V_i(\mathbf{pa}_i) = f_{V_i}(\mathbf{pa}_i, \epsilon_{i})$$`

---

## Example 

This graph

&lt;center&gt; 

&lt;img src="img/2_swig6_fig9.png" width="40%" /&gt;

&lt;/center&gt;

corresponds to equations

`$$Z = f_Z(\epsilon_Z)$$`
`$$M(z) = f_M(z, \epsilon_M)$$`
`$$Y(z, m) = f_Y(z, m, \epsilon_Y)$$`
---

## Special Case: Linear Structural Equation Models

- A linear SEM is the special case that `\(f_{V_1}, \dots, f_{V_n}\)` are linear and `\(\epsilon_{1}, \dots, \epsilon_n\)` are mutually independent. 

- In the previous example, a linear SEM would be 

$$
`\begin{split}
&amp;Z = \epsilon_Z\\
&amp;M = \beta_{ZM} Z + \epsilon_M\\
&amp;Y = \beta_{ZY} Z + \beta_{MY} M + \epsilon_Y
\end{split}`
$$
- In the linear case, the SEM can be written in matrix notation 

$$
\mathbf{V}(\mathbf{v}) = \mathbf{B}^{\top}\mathbf{v} + \boldsymbol{\epsilon}
$$

---

## Linear SEMs

- Lots of early work on causal inference deals specifically with linear SEMs. 

- Linear SEMs are easy to work with, so it is sometimes convenient to demonstrate a property using linear SEMs.

- However, this is a very restrictive model. 

- For now, we will try to make as few assumptions as possible. 

- When we start the modeling section, we will add some assumptions so that we can estimate parameters but it is nice to be clear about which assumptions are necessary and which are just a convenience. 

---

## Completing the Causal Model Definiton

- Our definition of NPSEMs is not quite sufficient to provide a causal model because it doesn't guarantee the causal Markov property. 

- For this we need an assumption about `\(\epsilon_1, \dots, \epsilon_n\)`.

- One sufficient assumption is that `\(\epsilon_1, \dots, \epsilon_n\)` are mutually independent of each other and
the other variables in the model. 

- Richardson and Robins call this the NPSEM-IE (IE = Independent Errors) model. They also propose a weaker set of assumptions that is also sufficient. 

- We will come back to this later.

---

# 4. The Backdoor Criterion

- Using DAGs to identify conditioning sets. 

- Confounding

- Colliding

---

## Exchangeability

- We want to know if the outcome `\(O\)` exchangeable with respect to the treatment? `\(O(t) \ci T\)`?

- If not, what set of variables, `\(L\)` can we condition on such that `\(O(t) \ci T \vert L\)`?

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cb92d7cfe73275fb9e84" style="width:432px;height:360px;"></div>
<script type="application/json" data-for="htmlwidget-cb92d7cfe73275fb9e84">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Age\nA\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,1.2!\"] \n  \"2\" [label = \"Severity\nS\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,-1.2!\"] \n  \"3\" [label = \"Treatment\nT\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"2,0!\"] \n  \"4\" [label = \"Outcome\nO\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"4,0!\"] \n  \"5\" [label = \"Adherence\nAd\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"3,1.2!\"] \n\"1\"->\"3\" [color = \"black\"] \n\"2\"->\"3\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"5\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

---

## Recognizing Lack of Exchangeability in a DAG

- Informally, there are two sources of lack of exchangeability:

  + The presence of common causes (confounders) that have not been conditioned on.
  + Common effects (colliders) that have been conditioned on. 
  
- We will see how to formalize these statements and how to use a DAG to identify a sufficient conditioning set to remove confounding.

---

## Common Causes (Confounders)

- The presence of a common cause introduces association between two variables that is not due to a causal effect. 

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-61698d3c657ddc2f071e" style="width:432px;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-61698d3c657ddc2f071e">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.5!\"] \n\"3\"->\"2\" [color = \"black\"] \n\"3\"->\"1\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

--

- In the disease treatment example, disease severity is a confounder:
  - Sicker patients are more likely to receive `\(A = 0\)` and sicker patients are also more likely to have a poor outcome.
  - So there would be an association between treatment and outcome, even if the two drugs worked equally well. 
  
---

## Confounding

- Confounding as a concept is quite old and therefore has been given many definitions. 

- We will define confounding as the lack of exchangeability that results from common causes. 
  
- *Confounders* are variables which can be used to adjust for confounding. 
  + In the graph below, `\(L_1\)` and `\(L_2\)` are both confounders, even though only `\(L_1\)` is a common cause of `\(A\)` and `\(Y\)`.
  
&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-12ed9b1396f0d303ff20" style="width:432px;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-12ed9b1396f0d303ff20">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.5,0!\"] \n  \"3\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.8!\"] \n  \"4\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0.4!\"] \n\"3\"->\"1\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"4\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;
---

## Common Effects (Colliders)

+ A variable `\(L\)` is a collider relative to `\(A\)` and `\(Y\)` if `\(L\)` is a descendant of both `\(A\)` and `\(Y.\)` 

+ The presence of a collider that is not conditioned on does not induce association between `\(A\)` and `\(Y\)`. 

+ But **conditioning on a collider** introduces an association between `\(A\)` and `\(Y\)`. 
  - This is not necessarily as intuitive as the bias introduced by a common cause. 
  
  
&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9df98b8e3dfb99733dc2" style="width:40%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-9df98b8e3dfb99733dc2">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,-0.5!\"] \n\"2\"->\"3\" [color = \"black\"] \n\"1\"->\"3\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>


&lt;/center&gt;

---

## Collider Example: Routes to Stardom

+ Suppose that in order to become a movie star, one must either be talented or beautiful. 

+ Suppose that in the population, talent and beauty are uncorrelated. 

+ But both talent and beauty increase a person's chance of becoming a star.

+ Then among those who are stars, beauty and talent will be negatively correlated.

&lt;center&gt;
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0b70b7d9db8611f84b84" style="width:504px;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-0b70b7d9db8611f84b84">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Talent\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.5\", color = \"black\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Beauty\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.5\", color = \"black\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0!\"] \n  \"3\" [label = \"Stardom\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.5\", color = \"black\", shape = \"ellipse\", fixedsize = \"FALSE\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,-0.75!\"] \n\"2\"->\"3\" [color = \"black\"] \n\"1\"->\"3\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;
---

## Collider Example: Routes to Stardom

&lt;img src="2_dags_confounding_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;

---

## Collider Example: Routes to Stardom

&lt;img src="2_dags_confounding_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;" /&gt;


---

## Colliders Can "Block" Confounding

- In the graph below, there is no confounding because there is no common cause of `\(A\)` and `\(Y\)`.

- The collider `\(L_2\)` is "blocking" the path from `\(A\)` to `\(Y\)`. 

- Causal Markov properties show us that `\(A\)` and `\(Y\)` are independent in this graph. 

- d-Separation formalizes the rules for identifying pairs of independent variables based on graphical rules.

&lt;center&gt;
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a0821fbc6707a475b5f0" style="width:432px;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-a0821fbc6707a475b5f0">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.5,0!\"] \n  \"3\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.8!\"] \n  \"4\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0.4!\"] \n\"3\"->\"1\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;
---

## No Statistical Definition of Confounding

- One commonly given characterization of a confounder is a variable which 

  + Is associated with the exposure.
  + Is associated with the outcome.
  + Is not on the pathway of interest between exposure and outcome. 
  
--

- Note that `\(L_2\)` satisfies all of these criteria but is not a confounder.

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c911fe65a2bcf54bc4de" style="width:432px;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-c911fe65a2bcf54bc4de">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.5,0!\"] \n  \"3\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.8!\"] \n  \"4\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0.4!\"] \n\"3\"->\"1\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

- Determining confounding requires a causal model. 
  + The data cannot tell you if confounding is present.
  
---

## d-Separation

+ A path is *blocked* if:
  1. Two arrowheads on the path collide ( `\(\rightarrow W \leftarrow\)` ) at a variable that is not being conditioned on *and* which has no descendants in the conditioning set. OR
  1. It contains a non-collider that is being conditioned on. 
  
+ A path is *open* if it is not blocked:
  - It does not contain a collider and no variables on the path are being conditioned on. OR
  - All colliders are conditioned on and no non-colliders are conditioned on.
  
+ Two variables are *d-separated* if all paths between them are blocked. 

---

## Examples:

Are `\(A\)` and `\(Y\)` d-separated?

&lt;center&gt;
.pull-left[
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8dc63e71e6fa2d83f8d4" style="width:80%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-8dc63e71e6fa2d83f8d4">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.5,0!\"] \n  \"3\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.8!\"] \n  \"4\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0.4!\"] \n\"3\"->\"1\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"4\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
]
.pull-right[
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1f12e9e560d9444391de" style="width:80%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-1f12e9e560d9444391de">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.5,0!\"] \n  \"3\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.8!\"] \n  \"4\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0.4!\"] \n\"3\"->\"1\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
]

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5472b84ea89a9f5f6016" style="width:40%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-5472b84ea89a9f5f6016">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.5,0!\"] \n  \"3\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.8!\"] \n  \"4\" [label = <L<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", shape = \"square\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0.4!\"] \n\"3\"->\"1\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

square = is conditioned on 
---

## d-Separation and the Causal Markov Property

Let `\(A\)`, `\(B\)`, and `\(C\)` be sets of variables. Verma and Pearl (1988) proved that:

If `\(A\)` and `\(B\)` are d-separated given `\(C\)` then `\(A \ci B \vert\ C\)`.

- We will not prove this in class. 

---
## Faithfulness

Faithfulness is the property that, for three sets of variables `\(A\)`, `\(B\)`, and `\(C\)`
`$$A \ci B \vert C \Rightarrow\ A \text{ is } d\text{-separated from }B\text{ given }C$$` 

- Violations of faithfulness occur when confounding effects perfectly cancel each other. 
  + Pearl calls these "incidental cancellations". 
  + And then defines "stable" vs "unstable" unbiasedness. Unstable unbiasedness occurs when faithfulness is violated. 
  
- Practically, we can assume that faithfulness is never violated except when it is violated by design.

- Matching studies intentionally violate faithfulness. 

---

## Example

Which pairs of variables are d-Separated unconditionally? 

&lt;center&gt;
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-90962c9d0b98faabace4" style="width:432px;height:360px;"></div>
<script type="application/json" data-for="htmlwidget-90962c9d0b98faabace4">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Age\nA\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,1.2!\"] \n  \"2\" [label = \"Severity\nS\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"0.2,-1.2!\"] \n  \"3\" [label = \"Treatment\nT\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"2,0!\"] \n  \"4\" [label = \"Outcome\nO\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"4,0!\"] \n  \"5\" [label = \"Adherence\nAd\", fontname = \"Helvetica\", fontsize = \"12\", color = \"black\", fontcolor = \"black\", fixedsize = \"TRUE\", width = \"1\", fillcolor = \"#FFFFFF\", pos = \"3,1.2!\"] \n\"1\"->\"3\" [color = \"black\"] \n\"2\"->\"3\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n\"5\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;

--

- The causal Markov property allowed us to conclude that `\(T \ci Ad \vert S, A\)`.
- Because `\(T\)` and `\(Ad\)` are d-separated, we can also conclude that `\(T \ci Ad\)` unconditionally.

---

## Backdoor Path

- A backdoor path from `\(A\)` to `\(Y\)` is a path from `\(A\)` to `\(Y\)` that begins with an edge going *into* `\(A\)`. 

- Find the backdoor paths from `\(A\)` to `\(Y\)`. 

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d609ad9932e9ab91af1c" style="width:60%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-d609ad9932e9ab91af1c">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.5,0.5!\"] \n  \"4\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.5,0!\"] \n  \"5\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"2.5,0!\"] \n  \"6\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"2,0.5!\"] \n\"1\"->\"2\" [color = \"black\"] \n\"3\"->\"2\" [color = \"black\"] \n\"3\"->\"1\" [color = \"black\"] \n\"4\"->\"5\" [color = \"black\"] \n\"6\"->\"5\" [color = \"black\"] \n\"4\"->\"6\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7dda49e07ff91c0ed33c" style="width:60%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-7dda49e07ff91c0ed33c">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.8,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.9,0.4!\"] \n  \"4\" [label = <U<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.45,0.9!\"] \n  \"5\" [label = <U<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.35,0.9!\"] \n\"4\"->\"1\" [color = \"black\"] \n\"4\"->\"3\" [color = \"black\"] \n\"5\"->\"3\" [color = \"black\"] \n\"5\"->\"2\" [color = \"black\"] \n\"1\"->\"2\" [color = \"black\"] \n\"3\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;


---

## Backdoor Criterion and Exchangeability

Theorem: If a set of variables, `\(L\)`, 
  + blocks every backdoor path between `\(A\)` and `\(Y\)` 
  + contains no descendants of `\(A\)`,
  
then `\(Y(a) \ci A \vert L\)`. 

--
- The two conditions in the theorem are referred to as the *backdoor criterion*. 



---

## Examples

Find a set of variables `\(H \subseteq \left \lbrace U_1, L, U_2 \right \rbrace\)` such that  `\(Y(a) \ci A \vert H\)`:

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-28c8d52edfa092adb4af" style="width:60%;height:216px;"></div>
<script type="application/json" data-for="htmlwidget-28c8d52edfa092adb4af">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.8,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.9,0.4!\"] \n  \"4\" [label = <U<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.45,0.9!\"] \n  \"5\" [label = <U<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.35,0.9!\"] \n\"4\"->\"1\" [color = \"black\"] \n\"4\"->\"3\" [color = \"black\"] \n\"5\"->\"3\" [color = \"black\"] \n\"5\"->\"2\" [color = \"black\"] \n\"1\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

--

- `\(A\)` and `\(Y\)` are exchangeable unconditionally, `\(Y(a) \ci A\)`, ( `\(H\)` is the emptyset). 

- Conditioning on `\(L\)` induces bias. (M-Bias), `\(Y(a) \nci A \vert L\)`.

- If we condition on `\(L\)`, we need to also condition on `\(U_1\)` or `\(U_2\)` to block the now open path.

---

## Examples

What set of variables can we condition on to make `\(A\)` and `\(Y\)` conditionally exchangeable?

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7b7ca9528d8577419f37" style="width:60%;height:216px;"></div>
<script type="application/json" data-for="htmlwidget-7b7ca9528d8577419f37">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.8,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.9,0.4!\"] \n  \"4\" [label = <U<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.45,0.9!\"] \n  \"5\" [label = <U<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>, fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.35,0.9!\"] \n\"4\"->\"1\" [color = \"black\"] \n\"4\"->\"3\" [color = \"black\"] \n\"5\"->\"3\" [color = \"black\"] \n\"5\"->\"2\" [color = \"black\"] \n\"1\"->\"2\" [color = \"black\"] \n\"3\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

--

-  `\(\lbrace U_1, L\rbrace\)` and `\(\lbrace U_2, L \rbrace\)` are both sufficient adjustment sets. 

- If `\(U_1\)` and `\(U_2\)` are unobserved, there is no available set of variables we can condition on to remove bias. 




---

## Examples

What set of variables can we condition on to make `\(A\)` and `\(Y\)` conditionally exchangeable?

&lt;center&gt;
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6bec274ccb0cce42b625" style="width:60%;height:216px;"></div>
<script type="application/json" data-for="htmlwidget-6bec274ccb0cce42b625">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0,0!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1.8,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.9,0!\"] \n  \"4\" [label = \"U\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.45,0.5!\"] \n\"1\"->\"3\" [color = \"black\"] \n\"3\"->\"2\" [color = \"black\"] \n\"4\"->\"1\" [color = \"black\"] \n\"4\"->\"3\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

--

-  Conditioning on `\(U\)` blocks all backdoor paths.

- Could we condition on `\(L\)` instead?

--

- No. `\(L\)` is a descendant of `\(A\)`, so it does not satisfy the backdoor criterion.



---
# 5. Single World Intervention Graphs

---

## Single World Intervention Graphs (SWIGs)

- SWIGs are a method of including counterfactuals in DAG proposed by Richardson and Robins.

- This is an alternative to Pearl's graph surgery strategy.

- SWIGs make the intervention more explicit. 

- Using SWIGs, we can evaluate conditional exchangeability using only `\(d\)`-separation without having to 
manage the other aspects of the backdoor criterion. 

---

## SWIGs

- To create a SWIG, the node representing the intervened on variable is split into two nodes. 
  - One node represents the natural value of of the variable.
  - The other represents the fixed value due to the intervention.

&lt;center&gt; 

&lt;img src="img/2_dag1.png" width="30%" /&gt;

&lt;img src="img/2_swig1.png" width="80%" /&gt;

&lt;/center&gt;

&lt;!-- --- --&gt;

&lt;!-- # SWIG Procedure --&gt;

&lt;!-- - To represent the counterfactual `\(Y(a)\)`, we split the node `\(A\)` in the original graph into two nodes: --&gt;

&lt;!-- - `\(A\)` (in the SWIG) represents the naturally occurring treatment -- what would have occurred with no intervention.  --&gt;
&lt;!--   + All of the arrows which entered into `\(A\)` in the original DAG will enter into `\(A\)` in the SWIG. --&gt;

&lt;!-- - `\(a\)` represents the intervened on value of the treatment.  --&gt;
&lt;!--   + This variable is fixed at the value `\(a\)` (i.e. it is deterministic rather than random). --&gt;
&lt;!--   + All arrows which exited `\(A\)` in the original DAG now exit the `\(a\)` intervention node. --&gt;
&lt;!--   + All variables which were downstream of `\(A\)` in the original DAG are replaced by their counterfactual values.  --&gt;

---


## Templates (SWITs)

- Each SWIG can represent only a single intervention, i.e. the world in which everyone receives treatment `\(A = a\)`. 

- A template is graph valued function `\(x \rightarrow \mathcal{G}(x)\)`.  The input is the value the intervened on variable is set to, the output is a SWIG.
  
&lt;center&gt; 


&lt;img src="img/2_swig1.png" width="80%" /&gt;


&lt;img src="img/2_swig4.png" width="40%" /&gt;

&lt;/center&gt;
  
---

## Single World

+ `\(Y(0)\)` and `\(Y(1)\)` never appear on the same graph.

+ SWIGs cannot represent relationships between counterfactuals "across worlds" (i.e. `\(Y(0)\)` and `\(Y(1)\)` ).

+ From the SWIGs below, we can conclude `\(Y(0) \ci X\)` and `\(Y(1) \ci X\)` but not `\(Y(1), Y(0) \ci X\)` or `\(Y(1) \ci Y(0)\)`.

&lt;center&gt; 


&lt;img src="img/2_swig1.png" width="80%" /&gt;

&lt;/center&gt;

---

## SWIG Procedure

- Step 1: Split nodes

&lt;center&gt; 


&lt;img src="img/2_split_nodes.png" width="40%" /&gt;

&lt;/center&gt;

- Split every intervention node into
  - `\(A\)` the random component; what `\(A\)` would have been without intervention.
  - `\(a\)` a fixed component representing the intervention.

- Incoming arrows go into `\(A\)` and outgoing arrows go out of `\(a\)`. 

---

## SWIG Procedure

- Step 2: Re-label downstream nodes as counterfactuals.

&lt;center&gt; 


&lt;img src="img/2_label_nodes.png" width="80%" /&gt;

&lt;/center&gt;
---

## d-Separation in SWIGs

- In a SWIG, any path containing an intervention node is blocked. 

- This sounds like a new rule but isn't really. 

- Intervention nodes are fixed at a value, so no information can propogate through. 

- Fixed nodes in any graph block a path. 

- However, it is atypical to include fixed nodes in a graph so this is an important rule to remember for SWIGs.

---

## d-Separation in SWIGs

- Under the NPSEM-IE assumptions, `\(d\)`-separation in the SWIG implies exchangeability. 

- That is, if `\(\mathcal{G}(a)\)` is the SWIG of the intervention `\(A = a\)` and `\(Y(a)\)` and `\(A\)` are `\(d\)`-separated in `\(\mathcal{G}(a)\)`, then 
`$$Y(a) \ci A$$`

- We have a similar result for conditional exchangeability. 

- If `\(Y(a)\)` and `\(A\)` are `\(d\)`-separated in `\(\mathcal{G}(a)\)` conditional on a set of nodes `\(L\)`, then 
`$$Y(a) \ci A \vert \ L$$`
- NPSEM-IE is stronger than necessary to achieve this result. 

&lt;!-- - Alternatively, `\(A\)` and `\(Y\)` are d-separated in `\(\mathcal{G}(a)\)` if they are d-separated in the subgraph of `\(\mathcal{G}(a)\)` achieved by removing all of the fixed nodes.  --&gt;

&lt;!-- - Remember, intervention nodes are fixed at a single value, so no information can propogate through them. --&gt;

&lt;!-- - We are heading toward the result that (conditional) d-separation of `\(Y(a)\)` and `\(A\)` in a SWIG `\(\mathcal{G}(a)\)` implies (conditional) exchangeability of `\(Y(a)\)` and `\(A\)`.  --&gt;

---
## Applying d-separation in SWIGs

&lt;center&gt; 


&lt;img src="img/2_fig16.png" width="80%" /&gt;

&lt;/center&gt;

- This is the M-Bias example. 

- We can see that `\(Y(a)\)` is d-separated from `\(A\)` unconditionally.

- Conditional on `\(Z\)`, `\(Y(a)\)` is not d-separated from `\(A\)`. 

---


## Independence Assumptions

- As we said before, the NPSEM model is not sufficient to conclude the causal Markov property. We need an additional assumption.

- FFRCISTG Assumption: Let `\(\mathbf{v}^\dagger\)` be an intervention on every variable in `\(V\)`. The FFRCISTG independence assumption says that all of the counterfactual variables `\(\lbrace V(\mathbf{v}^\dagger) \rbrace\)` are mutually independent after this intervention. 

- NPSEM-IE assumption: The NPSEM-IE assumption says that all of the errors `\(\epsilon_V\)` are independent. 

- NPSEM-IE is strictly stronger than FFRCISTG.

- NPSEM-IE implies cross-world independences while FFRCISTG does not. 

- We will generally always assume FFRCISTG.

---

## FFRCISTG vs NPSEM-IE
&lt;center&gt; 

&lt;img src="img/2_swig6_fig9.png" width="40%" /&gt;

&lt;/center&gt;

- FFRCISTG says $$ Z\ci M(z) \ci Y(z, m)$$ for any `\(z\)` and `\(m\)`.

- NPSEM-IE says `$$Z \ci \lbrace M(z) \text{ for all } z \rbrace \ci \lbrace Y(z, m)\ \text{for all } z, m \rbrace$$`

  - For example, `\(M(Z = 0) \ci Y(Z = 1, M = 0)\)`.

---

## Factorization Result

- An important result is that the FFRCISTG assumption is sufficient to conclude that if  `\(P(\mathbf{V})\)` factorizes according to `\(\mathcal{G}\)` then  `\(P(\mathbf{V}(\mathbf{a}))\)` factorizes according to the SWIG `\(\mathcal{G}(\mathbf{a})\)`. 


- This result is saying that the SWIG is an accurate representation of the world of intervention `\(\mathbf{a}\)`.

- The proof of this result works by reverse induction. 

- We won't prove this in class but there is a nice illustration in Appendix B1 of Richardson and Robins (2013).
  
---

## SWIGs, Exchangeability, and d-Separation

- The factorization result allows us to conclude that d-separation in the SWIG implies conditional exchangeability. 

- Recall: Conditional exchangeability says that `\(Y(a) \ci A \vert L\)`, which is exactly what is implied by `\(d\)`-separation in the SWIG. 

- `\(d\)`-separation in the SWIG is equivalent to satisfying the backdoor criterion. 

- So the proof of the factorization result also implies that proof also shows that the FFRCISTG assumptions are sufficient for the backdoor backdoor criterion theorem to hold

- Since NPSEM-IE is strictly stronger than FFRCISTG, NPSEM-IE assumptions also imply that the backdoor criterion theorem holds. 

---

## Descendents of `\(A\)` 

+ Using SWIGs helps show why the backdoor criterion excludes descendants of `\(A\)`. 

&lt;center&gt;
&lt;img src="img/2_swig3.png" width="50%" /&gt;

&lt;/center&gt;

+ From the SWIG on the right we can conclude that `\(Y(x) \ci X \vert L_1, L_2(x)\)`.

+ However, we cannot conclude that `\(Y(x) \ci X \vert L_1, L_2\)` because `\(L_2\)` is not on the graph. 

+ In fact, the second statement is false. Conditioning on `\(L_2\)` introduces a type of selection bias (more on this in L4).

---

## More Examples: Confounder

&lt;center&gt; 

&lt;img src="img/2_fig9iii.png" width="40%" /&gt;

&lt;/center&gt;

- `\(Y(m)\)` is not unconditionally independent of `\(M\)` but, `\(Y(m) \ci M \vert Z\)`

- The factorization result gives us
`$$P(Z, M, Y(m)) = P(Z)P(M \vert Z)P(Y(m) \vert Z)$$`

- Note that we left the fixed node out of the probability calculation.

---

## Mediator

&lt;center&gt; 

&lt;img src="img/2_fig9ii.png" width="40%" /&gt;

&lt;/center&gt;

- Here we do have unconditional exchangeability because `\(Y(z) \ci Z\)`. 

- From factorization, `\(P(Z, M(z), Y(z)) = P(Z)P(M(z))P(Y(z) \vert M(z))\)`

---

## Mediator with Two Interventions

&lt;center&gt; 

&lt;img src="img/2_fig9iv.png" width="40%" /&gt;

&lt;/center&gt;

- From this graph we can get `\(Y(z, m) \ci M(z)\)`. 

- We have to use the new rule that fixed nodes block paths.

- This is saying that intervening on `\(M\)` blocks the effect of `\(Z\)` that is propogated through `\(M(z)\)`. 

- From factorization, `\(P(Z, M(z), Y(z)) = P(Z)P(M(z))P(Y(z))\)`



---

## Mediation Effects

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-07cb323d92fb5c882cf2" style="width:40%;height:144px;"></div>
<script type="application/json" data-for="htmlwidget-07cb323d92fb5c882cf2">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"-0.1,0.5!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.2,0!\"] \n\"1\"->\"2\" [color = \"black\"] \n\"1\"->\"3\" [color = \"black\"] \n\"3\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;

- In the graph above, `\(L\)` is *mediating* part of the effect of `\(A\)` on `\(Y\)`. 

- Using our machinery so far, we can define the total effect (TE) of `\(A\)` on `\(Y\)` as
`$$E[Y(A = 1)] - E[Y(A = 0)]$$`
- We might be interested in the effect of `\(A\)` that is not mediated through `\(L\)`. 

- This would be the effect of `\(A\)` on `\(Y\)` if we intervened on `\(L\)` and prevented `\(L\)` from changing. 
  - For example, we intervene on `\(A\)` and set it to 1. 
  - But we intervene on `\(L\)` and set it to `\(L(0)\)`. 
---


## Natural Direct and Indirect Effect

&lt;center&gt;

<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1e43cbd45af143f59fe7" style="width:40%;height:144px;"></div>
<script type="application/json" data-for="htmlwidget-1e43cbd45af143f59fe7">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"-0.1,0.5!\"] \n  \"2\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"1,0!\"] \n  \"3\" [label = \"L\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", color = \"black\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\", pos = \"0.2,0!\"] \n\"1\"->\"2\" [color = \"black\"] \n\"1\"->\"3\" [color = \"black\"] \n\"3\"->\"2\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;
  
- The *natural direct effect*(NDE) is
`$$E[Y(A = 1, L = L(0))] - E[Y(A = 0, L = L(0)]$$`
- The *natural indirect effect*(NIE) is 

$$
E[Y(A = 1, L= L(1))] - E[Y(A = 1, L = L(0))]
$$
- So TE = NDE + NIE 

- Note that both of these involve "cross-world" counterfactuals.





---

## Identifying NIE and NDE

- The FFRCISTG independence assumption does not allow identification of the NIE and NDE. 

- See Robins and Greenland (1992) for a good example. 

- If we further assume the NPSEM-IE model, NIE and NDE are identifiable.

- We will come back to this in the future to talk more about mediation. 

&lt;!-- --- --&gt;

&lt;!-- ## Identifying the NDE under NPSEM-IE Assumptions --&gt;

&lt;!-- - Under NPSEM-IE assumptions, cross-world independcies hold.  --&gt;

&lt;!-- - Specifically, we have  --&gt;

&lt;!-- $$ Y(A = 1, l) \ci L(A = 0) \qquad \forall\ l $$ --&gt;
&lt;!-- - We want to estimate `\(E[Y(A = 1, L(A = 0))]\)`.  --&gt;

&lt;!-- $$ --&gt;
&lt;!-- E[Y(A = 1, L(A = 0))] = \sum_l E[Y(A = 1, L = l)\vert L(0) = l]P[L(0) = l] --&gt;
&lt;!-- $$ --&gt;
&lt;!-- $$ --&gt;
&lt;!-- =\sum_l E[Y(A = 1, L=l)]P[L(0) = l] --&gt;
&lt;!-- $$ --&gt;
&lt;!-- - The second equality comes from the independence assumption above.  --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Identifying the NDE under NPSEM-IE Assumptions --&gt;

&lt;!-- - We now only need to estimate `\(E[Y(A = 1, L = l)]\)` and `\(P[L(0) = l]\)` which can be estimated as --&gt;
&lt;!-- $$ --&gt;
&lt;!-- E[Y(A = 1, L = l)] = E[Y \vert A = 1, L = l] --&gt;
&lt;!-- $$ --&gt;
&lt;!-- $$ --&gt;
&lt;!-- P[L(0) = l ] = P[L=l \vert A = 0] --&gt;
&lt;!-- $$ --&gt;
&lt;!-- - Both equalities come from exchangeability --&gt;

&lt;!-- - So --&gt;

&lt;!-- $$ --&gt;
&lt;!-- E[Y(A = 1, L(A = 0))] = \sum_l E[Y \vert A = 1, L = l]P[L =l \vert A = 0] --&gt;
&lt;!-- $$ --&gt;

&lt;!-- --- --&gt;
&lt;!-- ## Non-Identifiability of NDE under FFRCISTG Intuition --&gt;

&lt;!-- - Consider two types of units: --&gt;
&lt;!--   + Both have `\(L(0) = 0\)` and `\(L(1) = 1\)` --&gt;

&lt;!-- - In both cases `\(Y(1, 1) = 1\)` and `\(Y(0, 0) = 0\)`. --&gt;

&lt;!-- - For type 1, `\(Y(1, 0) = 0\)` and for type 2 `\(Y(1, 0) = 1\)`. --&gt;
&lt;!--   - For type 1, if `\(A\)` had not caused `\(L\)`, they would not have experienced `\(Y\)`. --&gt;
&lt;!--   - For type 2, `\(L\)` did not matter.  --&gt;

&lt;!-- - Even if we could observe both types under both treatments of `\(L\)`, we could not tell them apart.  --&gt;

&lt;!-- - But type 1 individuals represent indirect effects while type 2 individuals represent direct effects. --&gt;

&lt;!-- --- --&gt;
&lt;!-- ## Controlled Direct and Indirect Effects --&gt;

&lt;!-- - Controlled effects are an alternative to natural effects.  --&gt;

&lt;!-- - These are the effect of `\(Y\)` when we control `\(L\)` at some pre-determined value. --&gt;

&lt;!-- `$$E[Y(A = 1, L = l)] - E[Y(A = 0, L = l)]$$` --&gt;

&lt;!-- - This definition only requires a joint intervention and doesn't require cross-world relationships between counterfactuals. --&gt;

&lt;!-- - Therefore CDE and CIE are identifiable under the FFRCISTG model. --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Extras: Collapsibility and Confounding --&gt;



&lt;!-- --- --&gt;
&lt;!-- ## Causal Identification --&gt;

&lt;!-- - Suppose I know the joint distribution `\(P(V)\)` over a set of variables.  --&gt;

&lt;!-- - Suppose I also assume: --&gt;
&lt;!--   - The distribution factorizes according to a DAG. --&gt;
&lt;!--   - We have observed all of the nodes on the DAG. --&gt;
&lt;!--   - Faithfulness --&gt;

&lt;!-- - When is it possible to infer the structure of the DAG? --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Markov Equivalence --&gt;

&lt;!-- - Multiple graphs can imply the same set of conditional independence relations. --&gt;

&lt;!-- - Two graphs `\(\mathcal{G}_1\)` and `\(\mathcal{G}_2\)` are Markov equivalent if they imply the same set of d-separation relations.  --&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
