<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>L3: Effect Modification and Interaction</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jean Morrison" />
    <script src="libs/header-attrs-2.9/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# L3: Effect Modification and Interaction
### Jean Morrison
### University of Michigan
### 2022-01-19 (updated: 2022-01-18)

---


# Effect Modification Example

- As usual (so far), suppose we have a binary treatment `\(A\)` and a binary outcome `\(Y\)`. 

- Suppose `\(V\)` is a binary variable representing a pre-existing co-morbidity.

- We want to know if treatment `\(A\)` has the same effect in patients with `\(V=1\)` and patients with `\(V = 0\)`.

`\(\newcommand{\ci}{\perp\!\!\!\perp}\)`
---

# Effect Modification Example

&lt;table class="table" style="width: auto !important; float: left; margin-right: 10px;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(V\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table class="table" style="width: auto !important; margin-right: 0; margin-left: auto"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(V\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

`$$E[Y(1) \vert V = 0] - E[Y(0) \vert V = 0] = 0.5 - 0.6 = -0.1$$`
`$$E[Y(1) \vert V = 10] - E[Y(0) \vert V = 1] = 0.7 - 0.4 = 0.3$$`


---

# Effect Modification Definition

- Variable `\(V\)` is a *modifier* of the effect of `\(A\)` on `\(Y\)` if the causal effect differs over strata of `\(V\)`.

- Effect modification does not care about mechansim. 
  
    + `\(V\)` can be an effect modifier without mechanistically altering the effect of `\(A\)`.
    + `\(V\)` need not even be causally related to `\(Y\)`.

- Effect modification depends on the choice of effect measurement.

---

# Additive and Multiplicative Modification

- Additive effect modification:

$$
E[Y(1) \vert V = 1] - E[Y(0) \vert V = 1)] \neq \\
E[Y(1) \vert V = 0] - E[Y(0) \vert V = 0)] 
$$

- Multiplicative effect modification:

$$
\frac{E[Y(1) \vert V = 1]}{E[Y(0) \vert V = 1)]} \neq \frac{E[Y(1) \vert V = 0]}{ E[Y(0) \vert V = 0)]}
$$
--

- Does additive modification imply multiplicative modification? What about vice versa?

---
# Additive vs Multiplicative Modification

&lt;table&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;\(V = 0 \)&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;\( V = 1\)&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Combined&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 1\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 1\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 1\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: solid;"&gt; \((P[Y(a) = 1)]\) &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.6 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;border-right: solid;"&gt; 0.80 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;border-right: solid;"&gt; 0.4 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.4 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Risk Difference &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 0.20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Risk Ratio &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 1.33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 2.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


&lt;br&gt;

&lt;table&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;\(V = 0 \)&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;\( V = 1\)&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Combined&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 1\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 1\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A = 1\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: solid;"&gt; \((P[Y(a) = 1)]\) &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;border-right: solid;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;border-right: solid;"&gt; 0.4 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.15 &lt;/td&gt;
   &lt;td style="text-align:right;border-bottom: solid;"&gt; 0.30 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Risk Difference &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.15 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Risk Ratio &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 2.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;border-right: solid;"&gt; 2.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.00 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---
# Types of Effect Modification

1. The causal effect has the same direction in all levels of `\(V\)`.

  + There may be effect modification only on the additive scale or only on the multiplicative scale.
  
1. The causal effect is exactly zero in at least one stratum of `\(V\)`.

  + If this type of effect modification is present on one scale, it will be present on the other. 

1. The causal effect has different signs in different starat of `\(V\)` (*qualitative modification*). 

  + If this type of effect modification is present on one scale, it will be present on the other. 

---

# Effect Modification in DAGs

- Effect modification is hard to represent in DAGs.

- There is no DAG feature that always corresponds to effect modification. 

- Effect modifiers are always connected to the outcome by an open path.

---

# Effect Modification in DAGs

- In all of the DAGs below, `\(V\)` could be a modifier of the effect of `\(A\)` on `\(Y\)`. 

&lt;center&gt;

<div id="htmlwidget-7d58abce2053a2454929" style="width:576px;height:216px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-7d58abce2053a2454929">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"V\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"-0.5,0.5!\"] \n  \"2\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"0,0!\"] \n  \"3\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"1,0!\"] \n  \"4\" [label = \"U\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"1.5,0.5!\"] \n  \"5\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"2,0!\"] \n  \"6\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"3,0!\"] \n  \"7\" [label = \"V\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"2,1!\"] \n  \"8\" [label = \"U\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"3.5,0.5!\"] \n  \"9\" [label = \"A\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"4,0!\"] \n  \"10\" [label = \"Y\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"5,0!\"] \n  \"11\" [label = \"V\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"circle\", fillcolor = \"#FFFFFF\", pos = \"3.5,1.2!\"] \n  \"12\" [label = \"W\", fontname = \"Helvetica\", fontsize = \"10\", width = \"0.3\", fontcolor = \"black\", color = \"black\", shape = \"square\", fillcolor = \"#FFFFFF\", pos = \"4,0.7!\"] \n\"1\"->\"3\" [color = \"black\"] \n\"2\"->\"3\" [color = \"black\"] \n\"4\"->\"6\" [color = \"black\"] \n\"5\"->\"6\" [color = \"black\"] \n\"4\"->\"7\" [color = \"black\"] \n\"8\"->\"10\" [color = \"black\"] \n\"9\"->\"10\" [color = \"black\"] \n\"8\"->\"12\" [color = \"black\"] \n\"11\"->\"12\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

- In the third graph, `\(W\)` is in the conditioning set.
  + Why is `\(V\)` associated with `\(Y\)`?

- In graphs 2 and 3, `\(V\)` is a *surrogate effect modifier*. 

---

# More on Effect Measures

- If 
  + there is a non-zero ATE of `\(A\)` on `\(Y\)` and 
  + `\(V\)` is associated with `\(Y\)`,
  
  then there is &lt;u&gt;always&lt;/u&gt; a modification on either the additive or multiplicative scale (or both).
  
- Hernán and Robins argue that the additive scale is usually preferable.

---


# Transportability

+ The ATE is the average effect in the population being sampled.

+ An effect estimate is *transportable* if it is a good estimate for the effect in other populations

+ Differences in effect modifiers between populations could lead to lack of transportability.

--

+ Example: 
  - In our population `\(P[V = 1] = 0.5\)`. 
  - Risk difference among those with `\(V = 0\)` is -0.1.
  - Risk difference among those with `\(V = 1\)` is 0.3.
  - What wold be a good effect estimate for a population in which everyone has `\(V = 0\)`?
  - How about a population in which `\(P[V = 1] = 0.25\)`?

--

+ There are no guarantees modifiers are transportable either.

---
# Example

- There are genetic variants that increase susceptibility to nicotine addiction. 

- In populations with easy access to smoking tobacco, these variants increase risk of lung cancer.

- Tobacco access is an effect modifier.

- Without accounting for tobacco access, our causal effect estimate is not transportable. 

&lt;center&gt;
<div id="htmlwidget-a56e939b13f92b785645" style="width:720px;height:180px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a56e939b13f92b785645">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Genotype\", fontname = \"Helvetica\", fontsize = \"20\", width = \"0.3\", fixedsize = \"FALSE\", fontcolor = \"black\", color = \"black\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", pos = \"0,0!\"] \n  \"2\" [label = \"Addiction\n Susceptibility\", fontname = \"Helvetica\", fontsize = \"20\", width = \"0.3\", fixedsize = \"FALSE\", fontcolor = \"black\", color = \"black\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", pos = \"3,0!\"] \n  \"3\" [label = \"Tobacco\n Access\", fontname = \"Helvetica\", fontsize = \"20\", width = \"0.3\", fixedsize = \"FALSE\", fontcolor = \"black\", color = \"black\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", pos = \"6,1.3!\"] \n  \"4\" [label = \"Smoking\", fontname = \"Helvetica\", fontsize = \"20\", width = \"0.3\", fixedsize = \"FALSE\", fontcolor = \"black\", color = \"black\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", pos = \"6,0!\"] \n  \"5\" [label = \"Lung Cancer\", fontname = \"Helvetica\", fontsize = \"20\", width = \"0.3\", fixedsize = \"FALSE\", fontcolor = \"black\", color = \"black\", shape = \"ellipse\", fillcolor = \"#FFFFFF\", pos = \"9,0!\"] \n\"1\"->\"2\" [color = \"black\"] \n\"2\"->\"4\" [color = \"black\"] \n\"4\"->\"5\" [color = \"black\"] \n\"3\"->\"4\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;
---
# Other Reasons to Care About Effect Modification

-  We might be interested in identifying subpopulations with the most to gain from an intervention. 
  + Should we only treat patients with `\(V = 1\)`?
  
- In some cases, identifying effect modifiers can provide information about the 
mechanism of the causal effect. 
  - In the genetic example, knowing that tobacco access modifies the effect may help us conclude that the genetic variant affects lung cancer because it affects smoking behavior.

---

# Identifying Counterfactual Means in Subgroups

- To characterize effect modification, we need to estimate `\(E[Y(a) \vert V = v]\)`. 

- Under what conditions is `\(E[Y(a) \vert V = v]\)` identifiable?

--

- If `\(E[Y(a)]\)` is identifiable then `\(E[Y(a) \vert V = v]\)` is identifiable.


- Recall the four conditions for identifying `\(E[Y(a)]\)`:
--

  + Consistency
  + No interference
  + Positivity
  + Conditional exchangeablity, conditional on observed variables `\(L\)`


---

# Estimating Counterfactual Means in Subgroups

We can use a two step estimation procedure:

1. Stratify the data by `\(V\)`.

2. Use standardization or IP weighting with `\(L\)` to estimate the expected counterfactual within each level of `\(V\)`.


---

# Standardization for Subgroup Effects

- The standardized mean of `\(Y(a) \vert V = v\)` is


$$
E[Y(a) \vert V = v] = \sum_{l}E[Y(a) \vert  V = v, L = l]P[L = l \vert V = v]
$$
$$
 = \sum_l E[Y \vert A = a, L = l, V = v]P[L = l \vert V = v]
$$ 
---

# IPW for Subgroup Effects 
- Or equivalently, the IPW mean:

$$
E[Y(a) \vert V = v] = E \left[\frac{I(A = a)Y}{f_{A \vert L, V =v}(A, L)} \Big\vert V = v\right ]
$$
- We simply compute the IPW mean within strata defined by `\(V\)`.

---

# Special Case: V = L

- If `\(Y(a) \ci A \vert L\)` and we are also interested in effect modification by `\(L\)`, we can skip the step of computing the standardized mean. 

- Instead, we simply stratify by `\(L\)` and compute `\(E[Y(a) \vert L = l] = E[Y \vert A = a, L = l]\)`. 

- These are the *stratified* means. 
---

# Special Case: V = A

- If there is effect modification by treatment status, the causal effect among those who received treatment `\(A=1\)` is different from the causal effect among those who received treatment `\(A = 0\)`. 

- The *average treatment effect among the treated* (ATT) is 
$$
E[Y(1) \vert A = 1] - E[Y(0) \vert A = 1]
$$
- Note that if the ATT is different from the ATE, this implies that unconditional exchangeability ( `\(Y(a) \ci A\)` ) does not hold. 

  + Why?
---

# Average Effect Among the Treated 

&lt;center&gt;
&lt;img src="img/3_att.png" width="85%" /&gt;
&lt;/center&gt;

---

# Identifying the ATT

- To identify the ATT, we don't need full conditional exchangeability which says that 
$$ Y(a) \ci A \vert L$$ for all `\(a\)`. 

- We only need *partial exchangeability*: `\(Y(0) \ci A \vert L\)`

--

- Equivalently, to identify the average effect among the non-treated, we need `\(Y(1) \ci A \vert L\)`.

- Generally, to identify `\(E[Y(a) \vert A = a^\prime]\)` we need $$ Y(a) \ci A \vert L$$ for all `\(a \neq a^\prime\)`.

---

# Standardization to Estimate the ATT

- From our previous expression for the conditional standardized mean

$$
E[Y(a) \vert A = 1] = \sum_l E[Y(a) \vert L=l, A = 1 ]P[L = l \vert A = 1]
$$

--

- From consistency we know
`$$E[Y(1) \vert L = l, A = 1] = E[Y \vert L = l, A = 1]$$`
--

- From partial exchangeability, we know that
$$
E[Y(0) \vert L = l, A = 1] = E[Y(0) \vert L = l]
$$
--

- Consistency again:

$$ E[Y(0) \vert L = l] = E[Y \vert L = l, A = 0]$$
--

- So

$$
E[Y(a) \vert A = 1] = \sum_l E[ Y \vert L=l, A = a ]P[L = l \vert A = 1]
$$

---


# Matching

- Matching is an alternative method to adjust for confounders `\(L\)`. 

- For each person receiving `\(A = 1\)`, we identify a "match" with the same value of `\(L\)` who received `\(A = 0\)`. 
  + We leave aside the rest of the data. 
  
- In the resulting matched population, the distribution of `\(L\)` is the same in the `\(A=1\)` and `\(A =0\)` cohorts. 

- Since we matched to the `\(A = 1\)` cohort, we are now able to estimate the ATT as `\(E_m[Y \vert A = 1] - E_m[Y \vert A = 0]\)` where the expectation is with respect to the matched population. 

- Alternatively, we could have matched to the `\(A = 0\)` cohort, or to a different distribution of `\(L\)`. 

---

# Interactions Describe Joint Interventions

- An *interaction* between variables refers to relationships between joint counterfactuals.

- We say that there is an additive interaction between `\(A\)` and `\(E\)` if 

`$$E[Y(A = 1, E = 0)] - E[Y(A = 0, E = 0)] \neq \\E[Y(A = 1, E = 1)] - E[Y(A = 0, E = 1)].$$`

- Like effect modification, interaction depends on the effect measure. 
  + There may be an additive but not a multiplicative interaction or vice versa.

---
# Interactions in DAGs

- Like effect modification, interactions are hard to clearly indicate in DAGs. 

- In order for an interaction between `\(A\)` and `\(E\)` to occur, `\(Y\)` must be 
a descendant of both `\(A\)` and `\(E\)`. 


&lt;center&gt;
&lt;img src="img/3_swig_ix.png" width="45%" /&gt;
&lt;/center&gt;

---
# Example

- `\(Y\)` indicates whether or not the lamp is on.

- `\(A\)` indicates if there is a bulb in the lamp.

- `\(E\)` indicates if the lamp is plugged in. 

- The lamp is on if it is pulgged in and has a bulb:  `\(Y(1, 1) = 1\)`

- Otherwise it is off: `\(Y(1, 0) = Y(0, 1) = Y(0, 0) = 0\)`. 

- There is an interaction because `\(Y(1, 0) - Y(0, 0) = 0\)` and `\(Y(1, 1) - Y(0, 1) = 1\)`. 
  + Adding a bulb is effective if the lamp is plugged in but otherwise is ineffective.
  
&lt;center&gt;
&lt;img src="img/3_swig_ix.png" width="35%" /&gt;
&lt;/center&gt;
---

# Identifying Interactions

- In order to identify an interaction, we must be able to identify `\(Y(a, e)\)` for all values of `\(a\)` and `\(e\)`. 

- We need our usual four identification criteria, but they need to apply to the joint counterfactual. 

- Consistency: `\(A_i = a\)` and `\(E_i = e\)` `\(\Rightarrow\)` `\(Y_i = Y_i(a, e)\)`.

- Positivity: `\(P[A = a, E=a \vert L = l] &gt; 0\)` for all `\(a\)`, `\(e\)`, `\(l\)`.

- Exchangeability: `\(Y(a, e) \ci A, E \vert L\)`

---

# Effect Modification vs Interaction

- When `\(Y(a, e) \ci A, E\)`, we have 
$$
E[Y(a, e)] = E[Y(a) \vert E = e] = E[Y(e) \vert A = a]= E[Y \vert A=a, E=e]
$$

- So interaction between `\(A\)` and `\(E\)` implies that `\(E\)` is a modifier of the effect of `\(A\)` on `\(Y\)`.

- Or equivalently, `\(A\)` is a modifier of the effect of `\(E\)` on `\(Y\)`. 

- If we are only willing to assume `\(Y(a) \ci A \vert L\)`, then we can identify modification but not interaction. 

---

# Collapsibility

- An association measure is *collapsible* with respect to a variable `\(Z\)` if the measure in the entire population is equal to a weighted average of the measure within strata.

- The average treatment effect and risk ratio are collapsible: 
$$
E[Y(1)] - E[Y(0)] = \sum_{z}(E[Y(1) \vert Z=z]-E[Y(0) \vert Z=z])P[Z=z]
$$

$$
\frac{E[Y(1)]}{E[Y(0)]} = \sum_l \frac{E[Y(1) \vert Z=z]}{E[Y(0) \vert Z=z]}w_z
$$
$$
w_z = \frac{E[Y(0)\vert Z=z]P[Z=z]}{E[Y(0)]}
$$
- For ATE and RR, if we know strata specific effects, we know the possible range of the population effect. 

- This is not the case for the odds ratio. 

---
# Collapsibility of Association Measures

- Effect measures are functions of the counterfactual distribution. 

- Association measures are functions of distribution of the observed data. 

- `\(E[Y(1)] - E[Y(0)]\)` is an effect measure. `\(E[Y \vert A = 1] - E[Y \vert A = 0]\)` is an association measure.

- The same definition of collapsibility applies to association measures.

- If `\(g(P(a, y))\)` is an association measure, then `\(g\)` is collapsible over `\(Z\)` if
  $$g(P(a, y)) = \sum_z g(P(a, y \vert z))w(z) $$
  where `\(w(z) \geq 0\)` and `\(\sum_z w(z) = 1.\)`

---

# Strict Collapsibility 

- An association measure is strictly collapsible over `\(A\)` if `\(g(P(a, y \vert z)) = g(P(a, y))\)` for all values of `\(z\)`.

- Strict collapsibility says that the association measure is the same within strata as in the population.


---

# Collapsibility and Confounding

- One definition of confounding says that if `\(g(P(a, y \vert z)) \neq g(P(a, y))\)`, then `\(Z\)` is a confounder and we should adjust for it. 

- Is this definition correct if `\(g\)` is the risk difference?

- What about risk ratio?

- What about odds ratio? 


---

# Collapsibility and Confounding

**Theorem:** If `\(g\)` is the risk difference, faithfulness holds, and `\(g\)` is collapsible over `\(Z\)` then `\(A\)` and `\(Y\)` are unconfounded by `\(Z\)`.

- The reverse is not true, if `\(g\)` is not collapsible over `\(Z\)`, we can't conclude that `\(Z\)` is a confounder. 

- This theorem does not hold for the odds ratio.

---
# Non-Collapsibility of the Odds Ratio

&lt;table&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Male&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Female&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Combined&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; \(A = 1\) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; \(A = 1\) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; \(A = 0\) &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; \(A = 1\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; \(Y = 0\) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 50 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 200 &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 150 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 300 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 200 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;border-bottom: solid;"&gt; \( Y= 1\) &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: solid;"&gt; 150 &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: solid;border-right: solid;"&gt; 200 &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: solid;"&gt; 50 &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: solid;border-right: solid;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: solid;"&gt; 200 &lt;/td&gt;
   &lt;td style="text-align:left;border-bottom: solid;"&gt; 300 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Risk &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.6 &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 0.8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 0.4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Risk Difference &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Risk Ratio &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 1.33 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Odds Ratio &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 2.67 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;border-right: solid;"&gt; 2.67 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2.25 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
